管理员创建应用
================================================================================

同时分配开发和测试机器
--------------------------------------------------------------------------------
1. 输入不存在的应用名字
2. 设置团队角色，开发测试 + 负责人
3. [下一步] 在同一个集群下，选择一部分机器为"开发测试"，选择一部分机器为"发布环境"。这两部分的机器不能有交集
4. [完成]
5. 应用可以成功创建
6. 开发测试和负责人都能够在"我的应用"里面可以看到刚创建的应用。
7. 为"开发测试环境"分配的机器上有这样的label: "idevops.app.{app_id}.develop = Y", 其中{app_id}是当前应用在数据库中的ID
8. 为"发布环境"分配的机器上有这样的label: "idevops.app.{app_id}.product = Y", 其中{app_id}是当前应用在数据库中的ID

只分配测试机器
--------------------------------------------------------------------------------
1. 输入不存在的应用名字
2. 设置团队角色，开发测试 + 负责人
3. [下一步] 在同一个集群下，选择一部分机器为"开发测试"
4. [完成] 应用可以成功创建，并且在"我的应用"里面可以看到刚创建的应用。

不能创建重复名字的应用
--------------------------------------------------------------------------------
1. [应用管理] --> [添加新应用]
2. 输入正确的图片，描述，项目代号，成员
3. 输入一个之前已经存在应用名字。(已经存在的应用，属于他人和属于自己的都需要测试)
4. [下一步] 设置机器
5. [完成] 将会提示类似"应用名字已经存在'的错误。页面停留在"应用管理"里面

必须为团队分配"开发测试"和"管理员"角色
--------------------------------------------------------------------------------
**测试步骤1**

1. [应用管理] --> [添加新应用]
2. 输入正确的名字，图片，描述，项目代号
3. 既不分配"开发测试"角色，也不分配"管理员"角色
4. [下一步] 错误提示: 请先添加成员

**测试步骤2**

1. [应用管理] --> [添加新应用]
2. 输入正确的名字，图片，描述，项目代号
3. 只分配"开发测试"角色
4. [下一步] 错误提示: 请先添加一位负责人

**测试步骤3**

1. [应用管理] --> [添加新应用]
2. 输入正确的名字，图片，描述，项目代号
3. 只分配"负责人"角色
4. OK

创建应用时必须为开发测试环境分配机器 (p1)
--------------------------------------------------------------------------------
**测试步骤1**

1. [应用管理] --> [添加新应用]
2. 输入正确的名字, 图片，描述，项目代号，成员
3. [下一步] 为开发和发布环境都**不**分配机器
4. [完成] 提示必须分配节点

**测试步骤2**

1. [应用管理] --> [添加新应用]
2. 输入正确的名字, 图片，描述，项目代号，成员
3. [下一步] 为发布环境分配一些节点，但是不为测试环境分配节点
4. [完成] 提示必须分配节点

管理员编辑应用
================================================================================

修改(删除/增加)开发测试角色
--------------------------------------------------------------------------------

**正常case1: 添加开发测试人员**

1. [应用管理] --> [设置]
2. 增加一个开发测试人员
3. [下一步]
4. [完成]
5. 新增加的开发测试人员能够在"我的应用"里面看到该应用

**正常case2: 删除开发测试人员 (p1)**

1. [应用管理] --> [设置]
2. 删除一个开发测试人员
3. [下一步]
4. [完成]
5. 删除后的开发测试人员**不能够**在"我的应用"里面看到该应用

**异常case1: 开发测试人员可以为空**

1. 删除所有开发测试人员，保留至少一个负责人
2. [下一步] 成功

为开发测试环境增加节点 (p1)
--------------------------------------------------------------------------------

**正常case1**

1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为开发测试环境增加一台机器
3. [完成]
4. 在新添加的机器上有这样的label: "idevops.app.{app_id}.develop = Y"

为开发测试环境减少节点 (p1)
--------------------------------------------------------------------------------
**正常case1: 减少1台机器**

0. 该应用有两台测试环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为开发测试环境减少一台机器
3. [完成]
4. 在减少的那台的机器上没有这样的label: "idevops.app.{app_id}.develop = Y"，其中{app_id}是当前应用在数据库中的ID

**正常case2: 减少2台机器**

0. 该应用有3台测试环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为开发测试环境减少2台机器
3. [完成]
4. 在减少的那2台的机器上没有这样的label: "idevops.app.{app_id}.develop = Y"，其中{app_id}是当前应用在数据库中的ID

**[P1] 正常case3: 减少机器时的提示**

0. 该应用有2台测试环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为开发测试环境减少1台机器
3. [完成]
4. 提示用户：在删除的机器上如果有当前应用的组件在运行，那么这些组件将会被kill并重新分配调度；如果有服务用了这个机器，需要手工去掉。

**异常case1: 测试环境的节点不能为空**

0. 该应用有1台测试环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为开发测试环境减少1台机器
3. [完成]
4. 提示用户：必须分配节点


为发布环境增加节点 (p1)
--------------------------------------------------------------------------------

**正常case1**

1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为发布环境增加一台机器
3. [完成]
4. 在新添加的机器上有这样的label: "idevops.app.{app_id}.product = Y"

为发布环境减少节点 (p1)
--------------------------------------------------------------------------------
**正常case1: 减少1台机器**

0. 该应用有两台发布环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为发布环境减少一台机器
3. [完成]
4. 在减少的那台的机器上没有这样的label: "idevops.app.{app_id}.product = Y"，其中{app_id}是当前应用在数据库中的ID

**正常case2: 减少2台机器**

0. 该应用有3台发布环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为发布环境减少2台机器
3. [完成]
4. 在减少的那2台的机器上没有这样的label: "idevops.app.{app_id}.product = Y"，其中{app_id}是当前应用在数据库中的ID

**正常case3: 完全删除发布环境的机器**

0. 该应用有3台发布环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为发布环境减少3台机器
3. [完成]
4. 在减少的那3台的机器上没有这样的label: "idevops.app.{app_id}.product = Y"，其中{app_id}是当前应用在数据库中的ID

**[P1] 正常case3: 减少机器时的提示**

0. 该应用有2台发布环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为发布环境减少1台机器
3. [完成]
4. 提示用户：在删除的机器上如果有当前应用的组件在运行，那么这些组件将会被kill并重新分配调度；如果有服务用了这个机器，需要手工去掉。

**异常case1: 测试环境的节点不能为空**

0. 该应用有1台测试环境的机器
1. [应用管理] --> [设置] --> [下一步]
2. 在同一个cluster上为开发测试环境减少1台机器
3. [完成]
4. 提示用户：必须分配节点

用户创建应用的测试实例
================================================================================


为应用创建第一个测试实例
--------------------------------------------------------------------------------

* 实例的名字必须满足规范：https://bitbucket.org/idevops/platform_frontend/issues/14/namespace
* 不能创建重名的实例

**测试步骤**

0. 该应用有1个测试环境用的机器
1. [我的应用] --> 选择应用 --> [新建环境]
2. 环境类别下拉列表里面只有"开发测试环境"
3. 输入一个不存在的环境名称
4. [确定]
5. 界面切换到[我的应用]/应用名字
6. 选择刚创建的测试环境
7. 切换到"部署"tab。
8. 点击[添加组件]
9. 输入正确的组件名字，版本号，镜像地址,内存设置，副本个数, 环境变量，主机端口映射，服务配置
10. 点击[保存]
11. 点击[部署]
12. 环境可以部署成功
13. 部署后的组件的版本号，内存设置，副本个数，环境变量，主机映射端口，服务配置，都应该是正确的。

添加组件
--------------------------------------------------------------------------------

* 组件名字是否符合规范: https://bitbucket.org/idevops/platform_frontend/issues/77/-------
* 版本号和镜像地址必填
* 内存设置不能设置为0
* 副本个数不能设置为0
* 可以设置环境变量。在实例运行后，在容器中能够看到设置的环境变量
* 设置的主机端口映射，在实例运行后，能够正确进行访问
* 设置正确的加载卷，在实例运行后，容器和宿主机可以同时访问该加载卷
* 设置好服务后，在实例运行后，能否访问到该服务
* 设置的端口必须是1-65535之间的数字 (p1)
* 脚本设置
* 组件依赖
    - 被依赖的不能是当前组件自身
    - 被依赖的组件没有服务设置
    - 被依赖的组件有服务设置

部署测试实例
================================================================================
* 测试实例只能运行在所分配的机器上

测试实例部署之后的UPDATE
================================================================================

* 增加组件，并部署
* 减少组件，并部署
* 只升级某个组件的版本
* 只升级某个组件的内存设置
* 增加组件副本
* 减少组件副本
* 增加环境变量
* 减少环境变量
* 修改某个环境变量的值
* 删除所有环境变量
* 增加主机端口映射
* 减少主机端口映射
* 删除所有主机端口映射
* 增加卷 (p1)
* 减少卷 (p1)
* 删除所有卷
* 增加服务的端口
* 减少服务的端口
* 增加服务的IP
* 减少服务的IP
* 删除组件的所有服务配置
* 修改脚本配置
* 增加组件依赖
* 减少组件依赖

同步组件 (p1)
--------------------------------------------------------------------------------

* 增加组件的case
* 减少组件的case
* 组件的配置是否有同步

用户创建应用的发布实例
================================================================================

为应用创建第一个发布环境
--------------------------------------------------------------------------------

1. 为应用创建第一个测试环境，并成功部署
2. 进入该应用的管理界面
3. 在"环境类别"中选择"正式发布"。 
4. 克隆之后确认一下功能：
    - 组件名字是否相同
    - 版本号和测试环境保持一致
    - 镜像地址和测试环境保持一致
    - 环境变量的值和测试环境保持一致
    - 主机映射端口和线下环境保持一致
    - 服务配置和线下环境保持一致

部署发布实例
================================================================================
* 实例的组件只能运行在所分配的机器上面

第一次部署
--------------------------------------------------------------------------------
1. 创建发布环境
2. 同步，选择测试环境的一个部署号
3. 修改组件参数
4. 部署
5. 审批

进行全组件版本升级
--------------------------------------------------------------------------------

进行部分组件版本升级
--------------------------------------------------------------------------------

增加组件升级
--------------------------------------------------------------------------------

删除组件升级
--------------------------------------------------------------------------------

只修改配置升级
--------------------------------------------------------------------------------

