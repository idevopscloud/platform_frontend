# 1.管理员创建应用
+ 同时分配开发和测试机器
+ 为团队分配"开发测试"和"管理员"角色

# 2.管理员编辑应用 （p1）
+ 修改(删除/增加)开发测试/负责人角色

# 3.用户部署一个测试实例
### 测试步骤
0. 该应用有1个测试环境用的机器
1. [我的应用] --> 选择应用 --> [新建环境]
2. 环境类别下拉列表里面只有"开发测试环境"
3. 输入一个不存在的环境名称
4. [确定]
5. 界面切换到[我的应用]/应用名字
6. 选择刚创建的测试环境
7. 切换到"部署"tab。
8. 点击[添加组件]
9. 输入正确的组件名字，版本号，镜像地址,内存设置，副本个数, 环境变量，主机端口映射，服务配置
10. 点击[保存]
11. 点击[部署]
12. 环境可以部署成功
13. 部署后的组件的版本号，内存设置，副本个数，环境变量，主机映射端口，服务配置，都应该是正确的。

### 测试要点
+ 组件名字是否符合规范: https://bitbucket.org/idevops/platform_frontend/issues/77/-------（p1）
+ 版本号和镜像地址必填（p1）
+ 内存设置不能设置为0（p1）
+ 副本个数不能设置为0（p1）
+ 可以设置环境变量。在实例运行后，在容器中能够看到设置的环境变量
+ 设置的主机端口映射，在实例运行后，能够正确进行访问
+ 设置正确的加载卷，在实例运行后，容器和宿主机可以同时访问该加载卷
+ 设置好服务后，在实例运行后，能否访问到该服务
+ 设置的端口必须是1-65535之间的数字 (p1)
+ 脚本设置
+ 组件依赖
    + 被依赖的不能是当前组件自身
    + 被依赖的组件没有服务设置
    + 被依赖的组件有服务设置

###check
+ 测试实例只能运行在所分配的机器上

# 4.测试实例的UPDATE

* 增加组件，并部署
* 减少组件，并部署
* 只升级某个组件的版本
* 只升级某个组件的内存设置
* 增加组件副本
* 减少组件副本
* 增加环境变量
* 减少环境变量（p1）
* 修改某个环境变量的值（p1）
* 删除所有环境变量（p1）
* 增加主机端口映射（p1）
* 减少主机端口映射（p1）
* 删除所有主机端口映射（p1）
* 删除所有卷（p1）
* 增加服务的端口
* 减少服务的端口（p1）
* 增加服务的IP
* 减少服务的IP（p1）
* 删除组件的所有服务配置（p1）
* 修改脚本配置（p1）
* 增加组件依赖
* 减少组件依赖

# 5.用户创建应用的发布实例
### pre action
1. 为应用创建第一个测试环境，并成功部署
2. 进入该应用的管理界面
3. 在"环境类别"中选择"正式发布"。 
4. 克隆之后确认一下功能：
    - 组件名字是否相同
    - 版本号和测试环境保持一致
    - 镜像地址和测试环境保持一致
    - 环境变量的值和测试环境保持一致
    - 主机映射端口和线下环境保持一致
    - 服务配置和线下环境保持一致

### deploy
1. 创建发布环境
2. 同步，选择测试环境的一个部署号
3. 修改组件参数
4. 部署
5. 审批

# 6.进行全组件版本升级

# 7.进行部分组件版本升级

# 8.增加组件升级（p0.5）

# 9.删除组件升级（p0.5）

# 10.只修改配置升级

# 11.E2E测试
## 11.1 创建一个APP 的测试实例（test-e2e），要求如下：
+ 包含3个组件：
    + Web:
        + image: xa.repo.ndp.com:5000/paas/nginx:latest
        + postStart: echo $HOSTNAME > /usr/share/nginx/html/index.html
        + replicas = 2
        + 暴露服务：container[80] -> service[172.30.10.185:41080]
    + backend1:
        + image: xa.repo.ndp.com:5000/paas/ubuntu-sshd:1.0.2
    + backend2:
        + image: xa.repo.ndp.com:5000/paas/ubuntu-sshd:1.0.2
+ 定义依赖关系
    + Web -> backend1 -> backend2

## 11.2 测试要点
+ check app的服务依赖性是否生效，包括部署时。
+ 查看Web的后端是否均可达，且具有LB效果
```
curl 172.30.10.185:41080
```

## 11.3 成功部署到线上
+ 修改服务地址：172.30.10.185:41080 -> 172.30.10.188:41080
+ 重复测试11.2